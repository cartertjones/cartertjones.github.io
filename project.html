<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Project Breakdown</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <nav class="navbar navbar-expand navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html#home">Carter Jones</a>
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="index.html#about">About</a></li>
                <li class="nav-item"><a class="nav-link" href="index.html#projects">Projects</a></li>
                <li class="nav-item"><a class="nav-link" href="index.html#contact">Contact</a></li>
            </ul>
        </div>
    </nav>

    <div class="content">
        <div class="container mt-5 pt-5">
            <!-- Header -->
            <h1 id="title"></h1>
            <h4 id="subtitle" class="subheader mb-4"></h4>
            <div id="media" class="mb-4"></div>

            <!-- Overview -->
            <section id="overview-section" class="mb-5 d-none">
                <h2>Overview</h2>
                <p id="overview"></p>
            </section>

            <!-- Contributions -->
            <section id="contributions-section" class="mb-5 d-none">
                <h2>My Contributions</h2>
                <p id="contributions"></p>
            </section>

            <!-- Tech Stack -->
            <section id="stack-section" class="mb-5 d-none">
                <h2>Technical Stack</h2>
                <div id="stack-icons" class="d-flex flex-wrap"></div>
            </section>

            <!-- Challenges -->
            <section id="challenges-section" class="mb-5 d-none">
                <h2>Challenges & Takeaways</h2>
                <p id="challenges"></p>
            </section>

            <!-- Contributors -->
            <section id="contributors-section" class="mb-5 d-none">
                <h2>Contributors</h2>
                <p id="contributors"></p>
            </section>

            <!-- Links -->
            <div class="mt-4">
                <a id="repo" class="btn main-button me-3 disabled" target="_blank">
                    <i class="fa fa-code-branch me-2"></i>Repository
                </a>
                <a href="index.html#projects" class="btn side-button">
                    <i class="fa fa-arrow-left me-2"></i>Back to Projects
                </a>
            </div>
        </div>
    </div>

    <script>
        async function loadProject() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get("id");

            try {
                const res = await fetch("projects.json");
                const projects = await res.json();
                const proj = projects.find(p => p.id === id);

                if (!proj) {
                    document.body.innerHTML = "<div class='container mt-5'><h2>Project not found</h2></div>";
                    return;
                }

                // Header
                document.getElementById("title").textContent = proj.title;
                document.getElementById("subtitle").textContent = proj.subtitle || "";

                // Media
                if (proj.media) {
                    document.getElementById("media").innerHTML =
                        proj.media.includes("youtube")
                            ? `<div class="ratio ratio-16x9"><iframe src="${proj.media}" frameborder="0" allowfullscreen></iframe></div>`
                            : `<img src="${proj.media}" class="img-fluid" alt="${proj.title}">`;
                }

                // Overview
                if (proj.overview && proj.overview.trim() !== "") {
                    document.getElementById("overview").textContent = proj.overview;
                    document.getElementById("overview-section").classList.remove("d-none");
                }

                // Contributions
                if (proj.contributions && proj.contributions.trim() !== "") {
                    document.getElementById("contributions").textContent = proj.contributions;
                    document.getElementById("contributions-section").classList.remove("d-none");
                }

                // Challenges
                if (proj.challenges && proj.challenges.trim() !== "") {
                    document.getElementById("challenges").textContent = proj.challenges;
                    document.getElementById("challenges-section").classList.remove("d-none");
                }

                // Contributors
                if (proj.contributors && proj.contributors.length > 0) {
                    document.getElementById("contributors").textContent = proj.contributors.join(", ");
                    document.getElementById("contributors-section").classList.remove("d-none");
                }

                // Tech Stack
                if (proj.stack && proj.stack.length > 0) {
                    const stackDiv = document.getElementById("stack-icons");
                    proj.stack.forEach(icon => {
                        const img = document.createElement("img");
                        img.src = `img/tech/${icon}.svg`;
                        img.alt = icon;
                        img.className = "tech-icon m-2";
                        stackDiv.appendChild(img);
                    });
                    document.getElementById("stack-section").classList.remove("d-none");
                }

                // Repo button
                if (proj.repo && proj.repo.trim() !== "") {
                    const repoBtn = document.getElementById("repo");
                    repoBtn.href = proj.repo;
                    repoBtn.classList.remove("disabled");
                }

            } catch (err) {
                console.error("Error loading project:", err);
                document.body.innerHTML = "<div class='container mt-5'><h2>Error loading project data.</h2></div>";
            }
        }

        loadProject();
    </script>
</body>

</html>